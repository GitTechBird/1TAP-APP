var x=(o,u,a)=>new Promise((l,h)=>{var j=s=>{try{t(a.next(s))}catch(d){h(d)}},f=s=>{try{t(a.throw(s))}catch(d){h(d)}},t=s=>s.done?l(s.value):Promise.resolve(s.value).then(j,f);t((a=a.apply(o,u)).next())});import{x as V,j as e,V as _,e as $,t as z,y as M,u as N,a as Q,r as n,g as q,d as G,F as i,B as p,I as w,H as J,A as K,z as W,i as X,C as Y,P as Z,D as ee,E as te,p as se,T as O}from"./index-6G_JhQkf.js";function P(o){const{children:u,ssr:a}=o,l=V(o);return e.jsx(_,{breakpoint:l,hide:!0,ssr:a,children:u})}P.displayName="Hide";const le=()=>{const o=$(),{currentUser:u,isValidating:a,login:l,logout:h,updateCurrentUser:j,getUserCookie:f}=z(),t=M(),s=N();let[d,ne]=Q();const[m,R]=n.useState(""),[y,re]=n.useState(null),[g,F]=n.useState(""),[b,C]=n.useState(""),[oe,v]=n.useState(!1),[E,I]=n.useState(""),[A]=q("(max-width: 767px)"),[T,S]=n.useState(!1);G();const D=n.useRef(null);n.useEffect(()=>{console.log("location",t)},[t]),n.useEffect(()=>{if(t.state&&t.state.loginResponse&&t.state.email){D.current=t.state.password;const{email:r,tmp_id:c}=t.state.loginResponse;R(t.state.email),C(c),v(!0),console.log("loginResponse",t.state.loginResponse),console.log("===",t.state.email)}},[t.state]);const B=()=>x(void 0,null,function*(){try{const r=yield l({username:t.state.email,password:t.state.password});C(r.tmp_id),F(""),console.log("loginResponse otp generate",r),s({title:`OTP has been sento to email : ${m}`,status:"success",duration:2e3,isClosable:!0})}catch(r){s({title:`Error while generating the OTP for email : ${m}`,status:"error",duration:2e3,isClosable:!0})}}),H=r=>x(void 0,null,function*(){r.preventDefault(),S(!0);try{if(b){const c=yield l({cmd:"login",otp:g,tmp_id:b}),U=decodeURIComponent(d.get("redirect-to"));o(`/authuser/${encodeURIComponent(m)}?redirect-to=${U}`)}else o("/login")}catch(c){console.error("handleOtpSubmit",c)}finally{S(!1)}}),L=r=>{F(r)},k=()=>{g.length!==6?I("OTP must be 6 digits"):I("")};return e.jsx(i,{justify:"center",align:"center",alignItems:"center",minHeight:"100vh",children:e.jsxs(i,{alignItems:"center",direction:"column",p:10,borderRadius:22,justifyContent:"center",flexBasis:{base:"auto",md:"60%"},bg:A?"transparent":"#BFE4FE",children:[e.jsx(p,{children:e.jsx(w,{src:"http://3.110.128.51/files/1tap-logo-color.png",alt:"1Tap Logo",h:"35"})}),e.jsxs(i,{direction:"row",alignItems:"center",justify:"center",children:[e.jsx(P,{below:"md",children:e.jsx(p,{flex:"1",mr:4,children:e.jsx(w,{src:"../shieldeef-preview.png",alt:"Dan Abramov"})})}),e.jsxs(p,{flex:"1",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",children:[e.jsxs(J,{as:"p",size:"sm",mb:4,children:["Please Enter OTP received on your email ",m]}),y&&e.jsxs(K,{status:"error",mb:4,children:[e.jsx(W,{}),y]}),e.jsxs("form",{onSubmit:H,children:[e.jsx(i,{justifyContent:"center",mt:4,children:e.jsxs(X,{isInvalid:!!E,children:[e.jsx(Y,{children:e.jsx(Z,{type:"text",name:"otp",value:g,onChange:L,onBlur:k,children:[...Array(6)].map((r,c)=>e.jsx(ee,{bg:"#FFFFFF"},c))})}),e.jsx(te,{children:E})]})}),e.jsxs(p,{mt:"3",textAlign:"center",children:[e.jsx(i,{justifyContent:"center",children:e.jsx(se,{type:"submit",mt:5,width:"60",bg:"#267FEA",color:"#FFFFFF",isLoading:T,mr:"5",children:"Verify"})}),e.jsx(i,{justifyContent:"center",mt:2,children:e.jsxs(O,{children:["Did not receive OTP?"," ",e.jsx("span",{style:{color:"#267FEA",cursor:"pointer"},onClick:()=>B(),children:"resend otp"})]})}),e.jsx(i,{justifyContent:"center",mt:2,children:e.jsxs(O,{children:["Already have an account?"," ",e.jsx("span",{style:{color:"#267FEA",cursor:"pointer"},onClick:()=>o("/login"),children:"Log in"})]})})]})]})]})]})]})})};export{le as default};
